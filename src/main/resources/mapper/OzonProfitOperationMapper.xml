<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.shopeeerp.mapper.OzonProfitOperationMapper">

    <resultMap id="BaseResultMap" type="com.example.shopeeerp.pojo.OzonProfitOperation">
        <id column="id" property="id" jdbcType="BIGINT"/>
        <result column="operation_id" property="operationId" jdbcType="BIGINT"/>
        <result column="operation_type" property="operationType" jdbcType="VARCHAR"/>
        <result column="operation_type_name" property="operationTypeName" jdbcType="VARCHAR"/>
        <result column="operation_date" property="operationDate" jdbcType="TIMESTAMP"/>
        <result column="delivery_charge" property="deliveryCharge" jdbcType="DECIMAL"/>
        <result column="return_delivery_charge" property="returnDeliveryCharge" jdbcType="DECIMAL"/>
        <result column="accruals_for_sale" property="accrualsForSale" jdbcType="DECIMAL"/>
        <result column="sale_commission" property="saleCommission" jdbcType="DECIMAL"/>
        <result column="amount" property="amount" jdbcType="DECIMAL"/>
        <result column="purchase_cost" property="purchaseCost" jdbcType="DECIMAL"/>
        <result column="type" property="type" jdbcType="VARCHAR"/>
        <result column="delivery_schema" property="deliverySchema" jdbcType="VARCHAR"/>
        <result column="order_date" property="orderDate" jdbcType="TIMESTAMP"/>
        <result column="posting_number" property="postingNumber" jdbcType="VARCHAR"/>
        <result column="warehouse_id" property="warehouseId" jdbcType="BIGINT"/>
        <result column="raw_items_json" property="rawItemsJson" jdbcType="LONGVARCHAR"/>
        <result column="raw_services_json" property="rawServicesJson" jdbcType="LONGVARCHAR"/>
        <result column="created_at" property="createdAt" jdbcType="TIMESTAMP"/>
        <result column="updated_at" property="updatedAt" jdbcType="TIMESTAMP"/>
    </resultMap>

    <sql id="Base_Column_List">
        id, operation_id, operation_type, operation_type_name, operation_date, delivery_charge,
        return_delivery_charge, accruals_for_sale, sale_commission, amount, purchase_cost, type, delivery_schema,
        order_date, posting_number, warehouse_id, raw_items_json, raw_services_json, created_at, updated_at
    </sql>

    <select id="selectByOperationId" parameterType="long" resultMap="BaseResultMap">
        SELECT <include refid="Base_Column_List"/> FROM ozon_profit_operation WHERE operation_id = #{operationId}
    </select>

    <delete id="deleteByDateRange">
        DELETE FROM ozon_profit_operation
        <where>
            <if test="from != null">operation_date &gt;= #{from}</if>
            <if test="from != null and to != null">AND</if>
            <if test="to != null">operation_date &lt;= #{to}</if>
        </where>
    </delete>

    <delete id="deleteByPostingNumber">
        DELETE FROM ozon_profit_operation
        <where>
            <if test="postingNumber != null and postingNumber != ''">
                posting_number = #{postingNumber}
            </if>
        </where>
    </delete>

    <insert id="insertBatch">
        INSERT INTO ozon_profit_operation (
        operation_id, operation_type, operation_type_name, operation_date, delivery_charge, return_delivery_charge,
        accruals_for_sale, sale_commission, amount, purchase_cost, type, delivery_schema, order_date, posting_number, warehouse_id,
        raw_items_json, raw_services_json, created_at, updated_at
        ) VALUES
        <foreach collection="list" item="item" separator=",">
            (
            #{item.operationId}, #{item.operationType}, #{item.operationTypeName}, #{item.operationDate},
            #{item.deliveryCharge}, #{item.returnDeliveryCharge},
            #{item.accrualsForSale}, #{item.saleCommission}, #{item.amount}, #{item.purchaseCost}, #{item.type},
            #{item.deliverySchema}, #{item.orderDate}, #{item.postingNumber}, #{item.warehouseId},
            #{item.rawItemsJson}, #{item.rawServicesJson}, #{item.createdAt}, #{item.updatedAt}
            )
        </foreach>
    </insert>
</mapper>
