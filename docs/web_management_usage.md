# Web管理界面使用指南

## 概述

Web管理界面提供了一个可视化的控制台，用于监控和管理Ozon Scraper的Worker系统和任务队列。

## 访问地址

启动后端服务后，在浏览器中访问：

```
http://localhost:8080/worker-management.html
```

## 功能特性

### 1. 实时统计卡片

页面顶部显示4个关键指标：

- **在线Worker**: 当前活跃的Worker数量
- **待处理任务**: 队列中等待处理的任务数
- **已完成任务**: 今日完成的任务数
- **失败任务**: 需要重试的失败任务数

这些统计数据每10秒自动刷新。

### 2. Worker监控页面

**功能**:
- 查看所有在线Worker的详细信息
- 实时显示Worker状态（空闲/忙碌/离线）
- 查看每个Worker的任务统计（总数/成功/失败）
- 显示最后心跳时间和IP地址

**表格列**:
- Worker ID: 唯一标识符
- 名称: Worker名称
- 浏览器: 浏览器类型和版本
- 状态: 当前状态（在线/离线/忙碌）
- 当前任务: 正在处理的任务ID
- 统计: 总任务数、成功数、失败数
- 最后心跳: 最后一次心跳时间
- IP地址: Worker的IP地址

### 3. 任务管理页面

**功能**:
- 查看任务队列中的所有任务
- 查看任务状态（待处理/处理中/已完成/失败/重试中）
- 添加新任务到队列
- 查看任务详情（URL、类型、优先级等）

**表格列**:
- ID: 任务ID
- 平台: 平台名称（ozon）
- 类型: 数据类型（product_detail/category_list）
- URL: 目标URL
- 状态: 任务状态
- Worker: 处理该任务的Worker ID
- 优先级: 任务优先级（1-10）
- 重试次数: 已重试次数
- 创建时间: 任务创建时间

**添加任务**:
1. 点击右上角的"➕ 添加任务"按钮
2. 填写任务信息：
   - 平台: 选择平台（默认Ozon）
   - 市场: 选择市场（默认RU）
   - URL: 输入目标URL
   - 数据类型: 选择商品详情页或分类列表页
   - 优先级: 设置优先级（1-10，数字越大优先级越高）
   - 额外配置: 可选的JSON配置（如 `{"max_products": 50, "max_pages": 3}`）
3. 点击"添加任务"按钮提交

### 4. 统计分析页面

显示系统的统计分析数据（开发中）。

未来将包括：
- 任务完成趋势图
- Worker性能分析
- 成功率统计
- 时间分布图

### 5. 自动刷新

- 所有数据每10秒自动刷新
- 刷新时右上角的刷新按钮会显示动画
- 可以手动点击"🔄 刷新"按钮立即刷新

## 使用场景

### 场景1: 监控Worker状态

1. 打开Web管理界面
2. 查看"Worker监控"标签页
3. 确认所有Worker都在线且正常工作
4. 检查是否有Worker长时间处于忙碌状态

### 场景2: 批量添加任务

1. 点击"➕ 添加任务"按钮
2. 填写第一个任务信息并提交
3. 重复步骤1-2添加更多任务
4. 切换到"任务管理"标签页查看任务队列

### 场景3: 排查任务失败

1. 查看顶部统计卡片中的"失败任务"数量
2. 切换到"任务管理"标签页
3. 查找状态为"失败"或"重试中"的任务
4. 检查任务的URL和配置是否正确
5. 如果需要，可以重新添加任务

### 场景4: 查看系统整体状态

1. 打开Web管理界面
2. 查看顶部4个统计卡片
3. 快速了解系统运行状况：
   - 有多少Worker在线
   - 队列中有多少待处理任务
   - 今日完成了多少任务
   - 有多少任务失败需要关注

## API端点

管理界面使用以下后端API：

### Worker相关
- `GET /market/workers/list` - 查询在线Worker列表

### 任务相关
- `GET /market/tasks/list?limit=100&status=PENDING` - 查询任务列表
- `POST /market/tasks/enqueue` - 添加任务到队列

## 技术特性

### 响应式设计
- 自适应不同屏幕尺寸
- 移动端友好

### 现代UI
- 渐变色背景
- 卡片式布局
- 平滑动画效果
- 状态徽章颜色编码

### 实时更新
- 10秒自动刷新
- 手动刷新按钮
- 刷新动画提示

### 用户体验
- 空状态提示
- 加载状态显示
- 错误提示
- 表格悬停高亮

## 浏览器兼容性

支持所有现代浏览器：
- Chrome 90+
- Firefox 88+
- Safari 14+
- Edge 90+

## 故障排查

### 问题1: 页面无法加载

**原因**: 后端服务未启动

**解决方案**:
```bash
cd d:\javaEverything\shopeeerp
mvn spring-boot:run
```

### 问题2: 数据显示为空

**原因**:
- 没有Worker在线
- 没有任务在队列中

**解决方案**:
1. 启动浏览器Worker（参考 [browser_worker_usage.md](browser_worker_usage.md)）
2. 添加任务到队列

### 问题3: 数据不刷新

**原因**:
- 浏览器控制台有错误
- 后端API返回错误

**解决方案**:
1. 打开浏览器开发者工具（F12）
2. 查看Console标签页的错误信息
3. 查看Network标签页的API请求状态
4. 检查后端日志

### 问题4: 添加任务失败

**原因**:
- URL格式不正确
- 额外配置JSON格式错误
- 后端验证失败

**解决方案**:
1. 确保URL是完整的Ozon商品或分类页面URL
2. 如果填写了额外配置，确保是有效的JSON格式
3. 查看浏览器控制台的错误提示

## 最佳实践

1. **定期检查**: 每天至少检查一次管理界面，确保系统正常运行
2. **监控失败任务**: 及时处理失败的任务，避免积压
3. **合理设置优先级**: 重要任务设置更高的优先级
4. **批量添加任务**: 一次性添加多个任务，提高效率
5. **保持Worker在线**: 确保至少有1-2个Worker在线处理任务

## 安全注意事项

1. **内网访问**: 管理界面应该只在内网访问，不要暴露到公网
2. **访问控制**: 如果需要，可以在Spring Boot中添加认证机制
3. **CORS配置**: 当前配置允许所有来源，生产环境应该限制

## 下一步

- 添加用户认证
- 实现任务编辑功能
- 添加任务删除功能
- 实现更详细的统计图表
- 添加实时日志查看
- 支持任务搜索和过滤
